<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <meta name="theme-color" content="#0e1117" />
  <meta name="description" content="AI Image Generator - T·∫°o ·∫£nh b·∫±ng AI v·ªõi Midjourney style" />
  
  <title>üé® AI Image Generator ‚Äî Midjourney Style</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  
  <!-- Favicon inline SVG -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé®</text></svg>" />
  
  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  
  <!-- Alpine.js CDN -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <!-- Stylesheet -->
  <link rel="stylesheet" href="style.css" />
</head>
<body class="dark">
  <div class="app-layout" x-data="appData()" x-cloak>
    <!-- Main Container -->
    <div class="container">
      <h1>üé® AI Image Generator</h1>
      
      <!-- Error Message -->
      <div x-show="errorMessage" class="error-message" x-text="errorMessage"></div>
      
      <!-- Success Message -->
      <div x-show="successMessage" class="success-message" x-text="successMessage"></div>
      
      <!-- Prompt Textarea -->
      <textarea 
        x-model="prompt" 
        placeholder="Nh·∫≠p prompt ƒë·ªÉ t·∫°o ·∫£nh (ti·∫øng Anh ho·∫∑c ti·∫øng Vi·ªát)..."
        @keydown.enter.ctrl="generateImage()"
      ></textarea>
      
      <!-- Aspect Ratio Selection (NEW FEATURE 1) -->
      <div class="aspect-ratio-section">
        <label class="aspect-ratio-label">üñºÔ∏è T·ª∑ l·ªá khung h√¨nh:</label>
        <div class="aspect-ratio-options">
          <label class="radio-option">
            <input type="radio" name="aspectRatio" value="16:9" x-model="aspectRatio" />
            <span>üì∫ Ngang (16:9)</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="aspectRatio" value="9:16" x-model="aspectRatio" />
            <span>üì± D·ªçc (9:16)</span>
          </label>
        </div>
      </div>
      
      <!-- Image Upload Slots -->
      <div class="image-slots-container">
        <template x-for="(slot, index) in imageSlots" :key="index">
          <div class="image-item">
            <div class="image-preview">
              <template x-if="slot.loading">
                <span class="loading-text">
                  <div class="loading-spinner"></div>
                  ƒêang t·∫£i...
                </span>
              </template>
              <template x-if="!slot.loading && !slot.preview">
                <span class="placeholder-text">Ch∆∞a c√≥ ·∫£nh</span>
              </template>
              <template x-if="!slot.loading && slot.preview">
                <img :src="slot.preview" :alt="'Preview ' + (index + 1)" />
              </template>
              <template x-if="slot.preview && slot.size">
                <div class="image-size-badge" x-text="slot.size"></div>
              </template>
            </div>
            <div class="image-actions">
              <button class="btn-upload" @click="$refs['fileInput' + index].click()">
                üì§ Ch·ªçn ·∫£nh
              </button>
              <button class="btn-delete" @click="deleteImage(index)" :disabled="!slot.file">
                üóëÔ∏è X√≥a
              </button>
            </div>
            <input 
              :ref="'fileInput' + index"
              type="file" 
              accept="image/*" 
              @change="handleFileSelect($event, index)" 
              style="display: none;"
            />
          </div>
        </template>
      </div>
      
      <button class="add-image-btn" @click="addImageSlot()">
        ‚ûï Th√™m slot ·∫£nh
      </button>
      
      <!-- Generate Button -->
      <button 
        class="btn-generate" 
        @click="generateImage()" 
        :disabled="isGenerating || !prompt.trim()"
      >
        <span x-show="!isGenerating">‚ú® T·∫°o ·∫£nh</span>
        <span x-show="isGenerating">
          <div class="loading-spinner"></div>
          ƒêang t·∫°o<span class="timer-badge" x-text="formatTime(elapsedTime)"></span>
        </span>
      </button>
      
      <!-- Clear All Button (NEW FEATURE 3) -->
      <button 
        class="btn-clear-all" 
        @click="clearAll()"
        :disabled="isGenerating"
      >
        üóëÔ∏è X√≥a t·∫•t c·∫£
      </button>
      
      <!-- Results Section -->
      <div x-show="results.length > 0" class="results-section">
        <h3>üì∏ K·∫øt qu·∫£ (<span x-text="results.length"></span>)</h3>
        <div class="results-grid">
          <template x-for="(result, index) in results" :key="index">
            <img 
              :src="result.url" 
              :alt="'Result ' + (index + 1)" 
              class="result-thumb"
              @click="showModal(result)"
            />
          </template>
        </div>
      </div>
    </div>
    
    <!-- History Panel -->
    <div class="history-panel">
      <div class="history-header">
        <h3>üìú L·ªãch s·ª≠</h3>
        <button class="btn-clear-history" @click="clearHistory()" :disabled="history.length === 0">
          X√≥a l·ªãch s·ª≠
        </button>
      </div>
      
      <template x-if="history.length === 0">
        <div class="empty-state">
          Ch∆∞a c√≥ ·∫£nh n√†o ƒë∆∞·ª£c t·∫°o
        </div>
      </template>
      
      <div class="results-grid">
        <template x-for="item in history" :key="item.id">
          <img 
            :src="item.url" 
            :alt="'History ' + item.id" 
            class="result-thumb"
            @click="showModal(item)"
          />
        </template>
      </div>
    </div>
    
    <!-- Modal (IMPROVED FEATURE 2) -->
    <div x-show="modalOpen" class="modal" style="display: flex;" @click.self="closeModal()">
      <div class="modal-overlay" @click="closeModal()"></div>
      <div class="modal-content-box">
        <button class="close-btn" @click="closeModal()">√ó</button>
        <img :src="modalImage" alt="Full size" class="modal-image" />
        
        <!-- Prompt Display (NEW FEATURE 2) -->
        <div class="modal-prompt-container" x-show="modalPrompt">
          <div class="modal-prompt-header">
            <span class="modal-prompt-label">üí¨ Prompt ƒë√£ s·ª≠ d·ª•ng:</span>
            <button class="btn-copy-prompt" @click="copyPrompt()" title="Copy prompt">
              <span x-text="promptCopied ? '‚úì ƒê√£ copy' : 'üìã Copy'"></span>
            </button>
          </div>
          <div class="modal-prompt-text" x-text="modalPrompt"></div>
        </div>
        
        <a :href="modalImage" download class="download-btn">
          üíæ T·∫£i xu·ªëng
        </a>
      </div>
    </div>
  </div>
  
  <script src="ai-app.js"></script>
</body>
</html>

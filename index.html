<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üé® AI Image Generator</title>
  <link rel="stylesheet" href="style.css" />

  <!-- ‚ö°Ô∏è Load app JS tr∆∞·ªõc ƒë·ªÉ Alpine nh·∫≠n di·ªán ƒë√∫ng -->
  <script src="ai-app.js" defer></script>

  <!-- ‚úÖ AlpineJS -->
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>

<body x-data="aiApp()" x-init="init()">

  <!-- KHU V·ª∞C CH√çNH -->
  <div class="container">
    <h1>üé® AI Image Generator</h1>

    <!-- PROMPT -->
    <div class="prompt-section">
      <label for="prompt">Prompt (M√¥ t·∫£ ·∫£nh b·∫°n mu·ªën t·∫°o)</label>
      <textarea x-model="prompt" placeholder="V√≠ d·ª•: g·ªôp c√°c m√≥n ƒÉn trong ·∫£nh th√†nh 1 poster ƒë·∫πp"></textarea>
    </div>

    <!-- UPLOAD -->
    <div class="upload-section">
      <label>Upload ·∫¢nh</label>
      <button class="add-image-btn" @click="addImageSlot()">‚ûï Th√™m ·∫£nh</button>

      <div class="images-container">
        <template x-for="(slot, index) in imageSlots" :key="slot.id">
          <div class="image-item" :class="{ 'base-image': index === 0 }">
            <span class="image-label" 
              x-text="index === 0 ? 'üéØ ·∫¢nh g·ªëc (Base Image)' : 'üì∑ ·∫¢nh tham kh·∫£o ' + index">
            </span>

            <div class="image-preview" :class="{ 'empty': !slot.preview }">
              <template x-if="slot.preview">
                <img :src="slot.preview" />
              </template>
              <template x-if="!slot.preview">
                <span>Ch∆∞a ch·ªçn ·∫£nh</span>
              </template>
            </div>

            <input type="file" accept="image/*" :id="'file-' + slot.id" 
              @change="handleFileSelect(slot, $event)" hidden>

            <div class="image-actions">
              <button class="btn-upload" 
                @click="document.getElementById('file-' + slot.id).click()">
                üìÅ Ch·ªçn ·∫£nh
              </button>
              <button class="btn-delete" 
                @click="deleteImageSlot(slot.id)"
                :disabled="index === 0 && imageSlots.length === 1">
                üóëÔ∏è X√≥a
              </button>
            </div>
          </div>
        </template>
      </div>
    </div>

    <!-- N√öT T·∫†O ·∫¢NH -->
    <div class="submit-section">
      <button class="btn-generate" :disabled="loading" @click="generateImage()" 
              x-text="loading ? '‚è≥ ƒêang x·ª≠ l√Ω...' : 'üöÄ T·∫°o ·∫¢nh'"></button>
    </div>

    <!-- TH√îNG B√ÅO L·ªñI -->
    <div class="error-message" x-show="errorMessage" x-text="errorMessage"></div>

    <!-- K·∫æT QU·∫¢ -->
    <div class="results-section" x-show="results.length > 0">
      <h3>üñºÔ∏è K·∫øt qu·∫£</h3>
      <div id="resultsGallery">
        <template x-for="(url, index) in results" :key="index">
          <img :src="url" class="result-thumb" @click="openModal(url)">
        </template>
      </div>
    </div>
  </div>

  <!-- PANEL L·ªäCH S·ª¨ -->
  <div class="history-panel" x-data="aiAppHistory()" x-init="init()">
    <h3>üïí L·ªãch s·ª≠ ·∫£nh (t·ª± x√≥a sau 24h)</h3>
    <div id="historyList">
      <template x-for="(item, index) in history" :key="index">
        <img :src="item.url" class="result-thumb" @click="window.openModal(item.url)">
      </template>
      <template x-if="history.length === 0">
        <p class="empty-history">Kh√¥ng c√≥ ·∫£nh trong 24h qua.</p>
      </template>
    </div>
  </div>

  <!-- POPUP XEM ·∫¢NH -->
  <template x-if="modalImage">
    <div class="modal" @click.self="closeModal()">
      <span class="close" @click="closeModal()">&times;</span>
      <img class="modal-content" :src="modalImage" />
      <a class="download-btn" :href="modalImage" download target="_blank">T·∫£i ·∫£nh v·ªÅ</a>
    </div>
  </template>

  <!-- ‚úÖ Debug log -->
  <script>
    document.addEventListener('alpine:init', () => {
      console.log('‚úÖ Alpine ƒë√£ s·∫µn s√†ng v√† nh·∫≠n di·ªán app!');
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Generator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"></script>
</head>
<body class="dark" x-data="aiApp()">
    <!-- Service Worker Registration -->


    <div class="app-layout">
        <!-- Main Container -->
        <div class="container">
            <h1>üé® AI Image Generator</h1>
            
            <!-- Success/Error Messages -->
            <template x-if="successMessage">
                <div class="success-message" x-text="successMessage" x-transition></div>
            </template>
            <template x-if="errorMessage">
                <div class="error-message" x-text="errorMessage" x-transition></div>
            </template>

            <!-- Prompt Input -->
            <div class="input-group">
                <label>Prompt (M√¥ t·∫£ ·∫£nh):</label>
                <textarea 
                    x-model="prompt" 
                    placeholder="M√¥ t·∫£ chi ti·∫øt ·∫£nh b·∫°n mu·ªën t·∫°o..."
                    @keydown.enter.exact.prevent="generateImages"
                    rows="3"
                ></textarea>
            </div>

            <!-- Aspect Ratio Selector -->
            <div class="input-group">
                <label>Khung ·∫£nh:</label>
                <div class="aspect-ratio-buttons">
                    <button 
                        type="button"
                        :class="['aspect-btn', selectedAspect === 'landscape' ? 'aspect-btn-active' : '']"
                        @click="selectedAspect = 'landscape'"
                    >
                        üì± Ngang (16:9)
                    </button>
                    <button 
                        type="button"
                        :class="['aspect-btn', selectedAspect === 'portrait' ? 'aspect-btn-active' : '']"
                        @click="selectedAspect = 'portrait'"
                    >
                        üì± D·ªçc (9:16)
                    </button>
                </div>
            </div>

            <!-- Image Upload -->
            <div class="image-slots-container">
                <template x-for="(image, index) in images" :key="image.id">
                    <div class="image-item">
                        <div class="image-preview">
                            <img :src="image.url" :alt="image.name" @load="onImageLoad($event, index)">
                            <span class="image-size-badge" x-show="!image.loaded">
                                <span class="loading-spinner"></span> ƒêang t·∫£i...
                            </span>
                            <span class="image-size-badge" x-show="image.loaded" x-text="formatFileSize(image.size)"></span>
                        </div>
                        <div class="image-actions">
                            <button class="btn-upload" @click="removeImage(index)">üóëÔ∏è X√≥a</button>
                        </div>
                    </div>
                </template>
                <button class="add-image-btn" @click="addImage()">
                    üìÅ Th√™m ·∫£nh tham kh·∫£o
                </button>
            </div>

            <!-- Generate Button -->
            <button 
                class="btn-generate" 
                :disabled="!canGenerate || isGenerating"
                @click="generateImages"
            >
                <span x-show="!isGenerating">‚ú® T·∫°o ·∫£nh</span>
                <span x-show="isGenerating">
                    <span class="loading-spinner"></span>
                    <span class="timer-badge" x-text="formatTimer()"></span>
                </span>
            </button>
        </div>

        <!-- Results -->
        <div class="results-section" x-show="results.length > 0">
            <h3>K·∫øt qu·∫£:</h3>
            <div class="results-grid">
                <template x-for="(result, index) in results" :key="result.id">
                    <img 
                        class="result-thumb" 
                        :src="result.url"
                        :alt="`Generated image ${index + 1}`"
                        :data-prompt="result.prompt"
                        @click="openModal(result.url, result.prompt)"
                        @load="onResultLoad($event)"
                    >
                </template>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" x-show="showModal" x-transition:enter="transitionIn" x-transition:leave="transitionOut" @click.away="closeModal()">
        <div class="modal-overlay"></div>
        <div class="modal-content-box" @click.stop>
            <button class="close-btn" @click="closeModal()">√ó</button>
            
            <!-- Image -->
            <img :src="modalImage" class="modal-image" alt="Full size image">
            
            <!-- Prompt -->
            <div class="modal-prompt-section">
                <label>Prompt ƒë√£ s·ª≠ d·ª•ng:</label>
                <div class="prompt-container">
                    <textarea readonly :value="modalPrompt" rows="4" class="prompt-textarea"></textarea>
                    <button class="copy-btn" @click="copyPrompt" title="Copy prompt">üìã</button>
                </div>
            </div>
            
            <!-- Download -->
            <a :href="modalImage" class="download-btn" download @click="closeModal()">
                üíæ T·∫£i ·∫£nh
            </a>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" ref="fileInput" accept="image/*" multiple style="display: none;" @change="handleFiles">

    <script src="ai-app.js"></script>
</body>
</html>
